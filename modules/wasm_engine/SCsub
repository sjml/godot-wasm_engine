Import("env")

platform_map = {"osx": "macos", "x11": "linux", "windows": "windows"}
platform = platform_map[env["platform"]]
arch_map = {"x86_64": "x86_64", "arm64": "aarch64"}
arch = arch_map[env["arch"]]

env_wasmtime = env.Clone()
env_wasmtime.add_source_files(env.modules_sources, "*.cpp")

env_wasmtime.Append(CPPPATH=["#modules/wasm_engine/wasmtime/include"])

env.Append(LIBPATH=[f"#modules/wasm_engine/wasmtime/lib/{arch}-{platform}"])

env.Append(LIBS=["wasmtime"])
